<html>
<head>
  <meta charset="UTF-8">
  <title>MoneyTrack - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <%= csrf_meta_tags %>
  <%= stylesheet_link_tag 'homestyle', media: 'all' %>
</head>
<body>
<header class="header">
  <div class="auth-buttons">
    <%= link_to "–í–æ–π—Ç–∏", login_path, class: "auth-button login-btn" %>
    <%= link_to "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è", register_path, class: "auth-button register-btn" %>
  </div>
  <h1>MoneyTrack</h1>
  <p>–í–∞—à –ª–∏—á–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫</p>
</header>

<section class="finance-section">
  <div class="account-card">
    <h2>–ö–æ–ø–∏–ª–∫–∞</h2>
    <div class="account-info">
      <p>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∫–æ–ø–∏—Ç—å</p>
    </div>
    <%= link_to "–ù–∞—á–∞—Ç—å –∫–æ–ø–∏—Ç—å", login_path, class: "account-button" %>
  </div>


  <div class="account-card">
    <h2>–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç</h2>
    <div class="account-info">
      <p>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å—á–µ—Ç</p>
    </div>
    <!--    <button class="account-button">–û—Ç–∫—Ä—ã—Ç—å —Å—á–µ—Ç</button>-->
    <%= link_to "–û—Ç–∫—Ä—ã—Ç—å —Å—á–µ—Ç", login_path, class: "account-button" %>
  </div>
</section>

<div class="container">
    <div class="card">
      <h2>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã</h2>
      <div class="advice-list">
        <% $arr_advices.each do |advice| %>
          <div class="tip">
            <h3>üí° –ü–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç</h3>
            <p><%= advice.content %></p>
          </div>
        <% end %>
      </div>
    </div>



  <div class="card">
    <h2>–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç RUB</h2>
    <div class="currency-list">
        <% $rates.each do |currency, rate| %>
          <% if rate.present? && rate != 0 %>
            <div class="currency-item">
              <span> <%= currency %> </span>
              <span><%= (1.0 / rate).round(2) %> RUB</span>
            </div>
          <% else %>
            <div class="currency-item">
              <span> <%= currency %> </span>
              <span>–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>
            </div>
          <% end %>
        <% end %>
    </div>
  </div>


  <div class="card">
    <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–∫—Ü–∏–∏</h2>

    <div class="stock-list">

    </div>
  </div>

  <!--  <div class="card">-->
  <!--    <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–∫—Ü–∏–∏</h2>-->
  <!--    <div class="stock-list">-->
  <%# $stocks.each do |stock| %>
  <!--        <div class="stock-item">-->
  <!--          <span><%#= stock[:ticker] %></span>-->
  <!--          <span><%#= number_to_currency(stock[:price], unit: '$', precision: 2) %></span>-->
  <%# if session[:user_id] %>
  <%# if current_user.favorites.exists?(ticker: stock[:ticker]) %>
  <!--              <button class="fav-btn active" data-ticker="<%#= stock[:ticker] %>">‚òÖ</button>-->
  <%# else %>
  <!--              <button class="fav-btn" data-ticker="<%#= stock[:ticker] %>">‚òÜ</button>-->
  <%# end %>
  <%# end %>
  <!--        </div>-->
  <%# end %>
  <!--    </div>-->
  <!--  </div>-->
</div>>


<footer class="footer">
  <div class="footer-content">
    <div class="footer-section">
      <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
      <p>üìç –ú–æ—Å–∫–≤–∞, —É–ª. –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è, 123</p>
      <p>üìû 8 (800) 123-45-67</p>
      <p>üìß support@moneytrack.ru</p>
    </div>
    <div class="footer-section">
      <h3>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h3>
      <p>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –ü—è—Ç–Ω–∏—Ü–∞: 9:00 - 20:00</p>
      <p>–°—É–±–±–æ—Ç–∞: 10:00 - 17:00</p>
      <p>–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: –≤—ã—Ö–æ–¥–Ω–æ–π</p>
    </div>
    <div class="footer-section">
      <h3>–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</h3>
      <div class="social-links">
        <a href="https://vk.com/moneytrack">VK</a>
        <a href="https://t.me/moneytrack">Telegram</a>
        <a href="https://www.youtube.com/moneytrack">YouTube</a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <p>¬© 2024 MoneyTrack. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
  </div>
</footer>

<script>
    // async function loadStocks() {
    //     try {
    //         const response = await fetch('/stocks/data');  // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ API
    //         const stocks = await response.json();
    //
    //         const stockList = document.getElementById('stock-list');
    //         stockList.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π
    //
    //         stocks.forEach(stock => {
    //             const stockItem = document.createElement('div');
    //             stockItem.classList.add('stock-item');
    //
    //             // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∏–∫–µ—Ä–µ –∏ —Ü–µ–Ω–µ
    //             stockItem.innerHTML = `
    //       <span>${stock.ticker}</span>
    //       <span>${stock.price.toFixed(2)} $</span>
    //     `;
    //
    //             // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω)
    //             if (userLoggedIn) {  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
    //                 const button = document.createElement('button');
    //                 button.classList.add('fav-btn');
    //                 button.dataset.ticker = stock.ticker;
    //
    //                 // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å–ª–∏ –∞–∫—Ü–∏—è –≤ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö
    //                 if (stock.isFavorite) {
    //                     button.classList.add('active');
    //                     button.textContent = '‚òÖ';
    //                 } else {
    //                     button.textContent = '‚òÜ';
    //                 }
    //
    //                 stockItem.appendChild(button);
    //             }
    //
    //             // –í—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–æ–∫
    //             stockList.appendChild(stockItem);
    //         });
    //     } catch (error) {
    //         console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–∫—Ü–∏–π:', error);
    //     }
    // }
    //
    // // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ü–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // window.onload = loadStocks;
    //app/javascript/packs/favorites.js

    document.addEventListener('DOMContentLoaded', () => {
        const stockListContainer = document.querySelector('.stock-list'); // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ –∞–∫—Ü–∏–π


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ü–∏–π
        function loadStocks() {
            fetch('/stocks/data', {
                headers: {
                    'Accept': 'application/json',
                    'X-CSRF-Token': getCSRFToken()
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞');
                    }
                    return response.json();
                })
                .then(data => {
                    renderStocks(data);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–∫—Ü–∏–π:', error);
                    showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–∫—Ü–∏–π.', 'error');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∞–∫—Ü–∏–π –≤ DOM
        function renderStocks(stocks) {
            stockListContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫

            stocks.forEach(stock => {
                const stockItem = document.createElement('div');
                stockItem.classList.add('stock-item');

                // –°–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ç–∏–∫–µ—Ä–∞
                const tickerSpan = document.createElement('span');
                tickerSpan.textContent = stock.ticker;

                // –°–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ü–µ–Ω—ã
                const priceSpan = document.createElement('span');
                priceSpan.textContent = `$${parseFloat(stock.price).toFixed(2)}`;

                // –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                // if (window.userLoggedIn === 'true') {
                //     console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω');
                //     const favButton = document.createElement('button');
                //     favButton.classList.add('fav-btn');
                //     favButton.dataset.ticker = stock.ticker;
                //     favButton.textContent = '‚òÜ'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º
                // }


                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∞–∫—Ü–∏—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞)

                // –í—Å—Ç–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ stock-item
                stockItem.appendChild(tickerSpan);
                stockItem.appendChild(priceSpan);
                //stockItem.appendChild(favButton);

                // –í—Å—Ç–∞–≤–ª—è–µ–º stock-item –≤ stock-list
                stockListContainer.appendChild(stockItem);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        function toggleFavorite(button, stockTicker, isActive) {
            if (!isActive) {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                addFavorite(button, stockTicker);
            } else {
                // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                removeFavorite(button, stockTicker);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ü–∏–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF-—Ç–æ–∫–µ–Ω–∞
        function getCSRFToken() {
            const tokenElement = document.querySelector('meta[name="csrf-token"]');
            return tokenElement ? tokenElement.getAttribute('content') : '';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            // –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–≤–æ—é –ª–æ–≥–∏–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            // –ù–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—è alert:
            alert(message);
            // –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—è –±–∏–±–ª–∏–æ—Ç–µ–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä Toastr:
            // toastr[type](message);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è localStorage
        function updateLocalStorage(stockTicker, action) {
            let favorites = JSON.parse(localStorage.getItem('favoriteStocks')) || [];

            if (action === 'add') {
                if (!favorites.includes(stockTicker)) {
                    favorites.push(stockTicker);
                }
            } else if (action === 'remove') {
                favorites = favorites.filter(stock => stock !== stockTicker);
            }

            localStorage.setItem('favoriteStocks', JSON.stringify(favorites));
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π –∏–∑ localStorage
        const currentFavorites = JSON.parse(localStorage.getItem('favoriteStocks')) || [];

        loadStocks()
    });

</script>
</body>
</html>
